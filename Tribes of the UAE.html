<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Tribal Network Graph</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* Custom font and base styling */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Prevent scrollbars from the main page */
        }
        /* Style for the SVG elements */
        .links line {
            stroke-opacity: 0.6;
        }
        .nodes circle {
            stroke: #fff;
            stroke-width: 1.5px;
        }
        .nodes circle:hover {
            cursor: pointer;
        }
        .labels text {
            font-size: 12px;
            fill: #333;
            pointer-events: none; /* Make text non-interactive */
            text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
        }
        /* Styling for the legend */
        .legend-color-box {
            width: 15px;
            height: 15px;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
            border-radius: 3px;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="flex h-screen w-screen">
        <!-- Main content area for the graph -->
        <div id="graph-container" class="flex-grow h-full relative">
            <!-- Filter Controls -->
            <div id="filters" class="absolute top-4 left-4 bg-white/80 backdrop-blur-sm p-4 rounded-lg shadow-md z-10">
                <h3 class="font-bold text-lg mb-2">Filter Relationships</h3>
                <div class="space-y-2">
                    <div>
                        <input type="checkbox" id="alliance" name="relation" value="alliance" checked class="form-checkbox h-5 w-5 text-green-500 rounded focus:ring-green-400">
                        <label for="alliance" class="ml-2 text-gray-700">Alliances & Support</label>
                    </div>
                    <div>
                        <input type="checkbox" id="conflict" name="relation" value="conflict" checked class="form-checkbox h-5 w-5 text-red-500 rounded focus:ring-red-400">
                        <label for="conflict" class="ml-2 text-gray-700">Conflicts & Opposition</label>
                    </div>
                    <div>
                        <input type="checkbox" id="subordination" name="relation" value="subordination" checked class="form-checkbox h-5 w-5 text-blue-500 rounded focus:ring-blue-400">
                        <label for="subordination" class="ml-2 text-gray-700">Subordination & Hierarchy</label>
                    </div>
                    <div>
                        <input type="checkbox" id="neutral" name="relation" value="neutral" checked class="form-checkbox h-5 w-5 text-gray-500 rounded focus:ring-gray-400">
                        <label for="neutral" class="ml-2 text-gray-700">Transactional & Neutral</label>
                    </div>
                </div>
            </div>
             <!-- Legend -->
            <div id="legend" class="absolute bottom-4 left-4 bg-white/80 backdrop-blur-sm p-4 rounded-lg shadow-md z-10">
                <h3 class="font-bold text-lg mb-2">Legend</h3>
                <div class="space-y-2">
                    <div class="flex items-center"><div class="legend-color-box bg-sky-600"></div><span>Core Abu Dhabi</span></div>
                    <div class="flex items-center"><div class="legend-color-box bg-orange-500"></div><span>Nomadic Tribes</span></div>
                    <div class="flex items-center"><div class="legend-color-box bg-slate-500"></div><span>Fringe Tribes</span></div>
                    <div class="flex items-center"><div class="legend-color-box bg-indigo-600"></div><span>Northern Qasimi Sphere</span></div>
                    <div class="flex items-center"><div class="legend-color-box bg-teal-600"></div><span>Mountain Tribes</span></div>
                </div>
            </div>
            <svg id="tribal-graph" class="w-full h-full"></svg>
        </div>

        <!-- Information Sidebar -->
        <div id="info-sidebar" class="w-full md:w-1/3 lg:w-1/4 h-full bg-white shadow-2xl p-6 overflow-y-auto transition-transform transform translate-x-full md:translate-x-0">
            <h2 id="info-title" class="text-2xl font-bold mb-4 text-gray-900">Select a Tribe</h2>
            <div id="info-content" class="text-gray-600 space-y-4">
                <p>Welcome to the interactive tribal network graph.</p>
                <p>Click on any tribe (circle) in the graph to see its detailed description and relationships here.</p>
                <p>You can also drag the tribes to rearrange the layout and use the filters to show or hide different types of relationships.</p>
            </div>
        </div>
    </div>

    <script>
        // --- DATA SETUP ---
        // This is where we convert the provided text into a structured format for D3.
        const dataset = {
            nodes: [
                // I. Core Abu Dhabi Tribes
                { id: "Bani Yas", group: 1, size: 20, description: "The dominant tribal confederation that formed the 'nation-state' of Abu Dhabi. Traditionally provided the paramount shaikh and Ruler. Engaged in pearling, date cultivation, and pastoralism." },
                { id: "Manaşir", group: 1, size: 15, description: "The most important tribe after Bani Yas, with whom they closely co-operated. Loyal subjects of the Al Bu Falah Rulers and often fought alongside them, sharing territory and resources." },
                { id: "Dhawahir", group: 1, size: 12, description: "The original inhabitants of the Buraimi oasis villages. They became subjects of the Ruler of Abu Dhabi and were the principal date cultivators of the oasis." },
                
                // II. Nomadic Tribes
                { id: "'Awamir", group: 2, size: 10, description: "Originally from Hadhramaut, some sections became loyal to the Al Bu Falah Ruler and supported the Bani Yas in war. Expected the Abu Dhabi shaikh to mediate disputes." },
                { id: "'Afar", group: 2, size: 8, description: "Often considered a section of the 'Awamir, they visited Abu Dhabi territory and joined in raids. Important tribe in Hadhramaut." },
                { id: "Al Murrah", group: 2, size: 10, description: "A powerful beduin tribe from Saudi Arabia. They owned date gardens in Liwa and paid tax, but were considered visitors, not subjects of Abu Dhabi." },
                
                // III. Fringe Tribes
                { id: "Na'im", group: 3, size: 18, description: "A numerous and widely dispersed tribe in the hinterland, but weakened by constant in-fighting. Sporadically professed loyalty to the Sultan of Muscat but also depended on assistance from Abu Dhabi." },
                { id: "Al Bū Shamis", group: 3, size: 10, description: "A section of the Na'im that established a nearly separate identity. Often associated with the Al Bu Falah and became their steadfast allies." },
                { id: "Bani Qitab", group: 3, size: 12, description: "A politically very important Ghafiri tribe with a large beduin contingent. Often at odds with their neighbors but friendly with the Dhahirah section." },
                { id: "Balūsh", group: 3, size: 8, description: "Settled population in Dhahirah with their own tribal organization. Maintained good relationships with the Bani Yas and sought help from them." },

                // IV. Northern Qasimi Sphere
                { id: "Qawāsim", group: 4, size: 18, description: "A powerful ruling clan that consolidated sovereignty over much of the northern coast. Their power was later reduced by British intervention and challenged by other tribes." },
                { id: "Sharqiyin", group: 4, size: 14, description: "Resided exclusively in Qasimi jurisdiction but led a secession to form the independent entity of Fujairah. Frequently disputed with neighbors to rally support against Qasimi rule." },
                { id: "Al 'Ali", group: 4, size: 10, description: "The tribe of the ruling family of Umm al Qaiwain. Challenged Abu Dhabi's influence over the beduin." },
                { id: "Za'ab", group: 4, size: 8, description: "A tribe with a stronghold at Jazirah al Hamra, often antagonistic to Ra's al Khaimah politics." },
                { id: "Naqbiyin", group: 4, size: 8, description: "A tribe living at close quarters with the Sharqiyin, often as natural rivals. They constituted the tribal majority in Khaur Fakkān and became a principal power in Kalba's bid for independence." },

                // V. Mountain Tribes
                { id: "Shihūh", group: 5, size: 15, description: "A unique and independent tribe from the Musandam Peninsula. Their inaccessibility allowed them to play larger powers against each other, including the Qawasim and the Sultan of Oman." },
                { id: "Sultan of Oman", group: 5, size: 15, description: "A major regional power whose influence was contested by various tribes, particularly in the Musandam and Buraimi regions." },
            ],
            links: [
                // Alliances
                { source: "Bani Yas", target: "Manaşir", type: "alliance" },
                { source: "Bani Yas", target: "'Awamir", type: "alliance" },
                { source: "Al Bū Shamis", target: "Bani Yas", type: "alliance" },
                { source: "Bani Yas", target: "Balūsh", type: "alliance" },
                { source: "Qawāsim", target: "Al 'Ali", type: "alliance" },

                // Conflicts
                { source: "Na'im", target: "'Awamir", type: "conflict" },
                { source: "Na'im", target: "Bani Qitab", type: "conflict" },
                { source: "Qawāsim", target: "Sultan of Oman", type: "conflict" },
                { source: "Qawāsim", target: "Sharqiyin", type: "conflict" },
                { source: "Qawāsim", target: "Shihūh", type: "conflict" },
                { source: "Za'ab", target: "Qawāsim", type: "conflict" },
                { source: "Na'im", target: "Qawāsim", type: "conflict" },
                { source: "Sharqiyin", target: "Naqbiyin", type: "conflict" },
                
                // Subordination
                { source: "Bani Yas", target: "Dhawahir", type: "subordination" },
                { source: "Qawāsim", target: "Za'ab", type: "subordination" },
                
                // Neutral / Transactional
                { source: "Bani Yas", target: "Al Murrah", type: "neutral" },
                { source: "Sultan of Oman", target: "Na'im", type: "neutral" },
                { source: "Shihūh", target: "Sultan of Oman", type: "neutral" },
                { source: "Bani Yas", target: "Shihūh", type: "neutral" },
            ]
        };

        // --- D3 IMPLEMENTATION ---

        const graphContainer = document.getElementById('graph-container');
        const width = graphContainer.clientWidth;
        const height = graphContainer.clientHeight;
        
        // Colors for groups and links
        const color = d3.scaleOrdinal(d3.schemeCategory10)
            .domain([1, 2, 3, 4, 5])
            .range(['#0ea5e9', '#f97316', '#64748b', '#4f46e5', '#0d9488']); // sky, orange, slate, indigo, teal
            
        const linkColor = {
            alliance: '#22c55e', // green-500
            conflict: '#ef4444', // red-500
            subordination: '#3b82f6', // blue-500
            neutral: '#8b5cf6' // violet-500
        };

        const linkStrokeStyle = {
            alliance: 'solid',
            conflict: 'dashed',
            subordination: 'dotted',
            neutral: 'solid'
        };

        let nodes = dataset.nodes.map(d => Object.assign({}, d));
        let links = dataset.links.map(d => Object.assign({}, d));

        // Create the SVG container
        const svg = d3.select("#tribal-graph")
            .attr("viewBox", [0, 0, width, height])
            .attr("preserveAspectRatio", "xMidYMid meet");

        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(150))
            .force("charge", d3.forceManyBody().strength(-400))
            .force("center", d3.forceCenter(width / 2, height / 2));

        const g = svg.append("g");

        let link = g.append("g")
            .attr("class", "links")
            .selectAll("line");

        let node = g.append("g")
            .attr("class", "nodes")
            .selectAll("circle");
            
        let label = g.append("g")
            .attr("class", "labels")
            .selectAll("text");

        // Function to update the graph based on filters
        function updateGraph() {
            const activeFilters = new Set();
            d3.selectAll("#filters input:checked").each(function(d) {
                activeFilters.add(this.value);
            });
            
            // Filter links
            const filteredLinks = links.filter(d => activeFilters.has(d.type));
            
            // Update links
            link = link
                .data(filteredLinks, d => `${d.source.id}-${d.target.id}`)
                .join("line")
                .style("stroke", d => linkColor[d.type])
                .style("stroke-width", 2.5)
                .style("stroke-dasharray", d => linkStrokeStyle[d.type] === 'dashed' ? '5,5' : (linkStrokeStyle[d.type] === 'dotted' ? '2,3' : 'none'));

            // Update nodes
            node = node
                .data(nodes, d => d.id)
                .join("circle")
                .attr("r", d => d.size || 10)
                .attr("fill", d => color(d.group))
                .on("click", nodeClicked)
                .on("mouseover", nodeMouseOver)
                .on("mouseout", nodeMouseOut)
                .call(drag(simulation));

            // Update labels
            label = label
                .data(nodes, d => d.id)
                .join("text")
                .text(d => d.id)
                .attr("x", 8)
                .attr("y", "0.31em");
            
            simulation.nodes(nodes);
            simulation.force("link").links(filteredLinks);
            simulation.alpha(1).restart();
        }

        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);
                
            label
                .attr("transform", d => `translate(${d.x},${d.y})`);
        });

        // Drag functionality
        const drag = simulation => {
            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }
            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }
            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
            return d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended);
        };
        
        // --- INTERACTIVITY FUNCTIONS ---
        const infoTitle = d3.select("#info-title");
        const infoContent = d3.select("#info-content");

        function nodeClicked(event, d) {
            infoTitle.text(d.id);
            infoContent.html(`<p>${d.description}</p>`);
        }

        function nodeMouseOver(event, d) {
            node.style('opacity', n => isConnected(d, n) ? 1.0 : 0.2);
            link.style('opacity', l => l.source === d || l.target === d ? 1.0 : 0.2);
            label.style('opacity', n => isConnected(d, n) ? 1.0 : 0.2);
        }

        function nodeMouseOut() {
            node.style('opacity', 1.0);
            link.style('opacity', 0.6);
            label.style('opacity', 1.0);
        }
        
        // Helper to check for connections
        const linkedByIndex = {};
        dataset.links.forEach(d => {
            linkedByIndex[`${d.source.id || d.source}-${d.target.id || d.target}`] = 1;
        });

        function isConnected(a, b) {
            return linkedByIndex[`${a.id}-${b.id}`] || linkedByIndex[`${b.id}-${a.id}`] || a.id === b.id;
        }
        
        // Add zoom functionality
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });
        
        svg.call(zoom);

        // Initial render
        updateGraph();
        
        // Event listener for filters
        d3.selectAll("#filters input").on("change", updateGraph);
        
        // Resize handler
        window.addEventListener('resize', () => {
            const newWidth = graphContainer.clientWidth;
            const newHeight = graphContainer.clientHeight;
            svg.attr("viewBox", [0, 0, newWidth, newHeight]);
            simulation.force("center", d3.forceCenter(newWidth / 2, newHeight / 2)).restart();
        });

    </script>
</body>
</html>